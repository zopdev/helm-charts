{{- range $index, $service := .Values.services }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $.Release.Name }}-{{ $service.name }}-init-script
  namespace: {{ $.Release.Namespace }}
data:
  init-schema.cql: |
    CREATE KEYSPACE IF NOT EXISTS "{{ $service.database }}"
    WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1};

    USE "{{ $service.database }}";
    
{{- end }}