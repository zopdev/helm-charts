apiVersion: v1
kind: Secret
metadata:
  name: {{ include "mosquitto.fullname" . }}-connection
  labels:
    app.kubernetes.io/name: {{ include "mosquitto.name" . }}
    app.kubernetes.io/instance: {{ .Release.Name }}
type: Opaque
stringData:
  {{- range $index, $user := .Values.auth.users }}
  MQTT_USERNAME_{{ $index }}: "{{ $user.username }}"
  MQTT_PASSWORD_{{ $index }}: "{{ $user.password }}"
  {{- end }}
  MQTT_USERNAME: "{{ (index .Values.auth.users 0).username }}"
  MQTT_PASSWORD: "{{ (index .Values.auth.users 0).password }}"
